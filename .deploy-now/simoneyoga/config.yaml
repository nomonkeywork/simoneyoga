# IONOS Deploy Now Configuration for Laravel
# https://docs.ionos.space/docs/deployment-configuration/

bootstrap:
  excludes:
    - .git
    - .github
    - .gitignore
    - .env.example
    - composer.json
    - composer.lock
    - package.json
    - package-lock.json
    - node_modules
    - tests
    - phpunit.xml
    - .phpunit.result.cache
    - frontend
    - backend
    - deploy
    - access.log.current

recurring:
  excludes:
    - storage/app
    - storage/logs
    - storage/framework/cache
    - storage/framework/sessions
    - storage/framework/views
    - .env
    - bootstrap/cache

runtime:
  pre-deployment-remote-commands:
    - echo "Starting maintenance mode"
    - php8.2-cli artisan down || php8.1-cli artisan down || true
  post-deployment-remote-commands:
    - echo "Clearing caches"
    - php8.2-cli artisan config:clear || php8.1-cli artisan config:clear || true
    - php8.2-cli artisan cache:clear || php8.1-cli artisan cache:clear || true
    - php8.2-cli artisan view:clear || php8.1-cli artisan view:clear || true
    - php8.2-cli artisan route:clear || php8.1-cli artisan route:clear || true
    - php8.2-cli artisan optimize || php8.1-cli artisan optimize || true
    - echo "Running migrations"
    - php8.2-cli artisan migrate --force || php8.1-cli artisan migrate --force || true
    - echo "Leaving maintenance mode"
    - php8.2-cli artisan up || php8.1-cli artisan up || true
    - echo "Deployment complete"
